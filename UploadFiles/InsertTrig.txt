USE ASItrackingDB
IF OBJECT_ID('TRG_InsertInv') IS NOT NULL
DROP TRIGGER TRG_InsertInv
GO

CREATE TRIGGER TRG_InsertInv 
ON tbl_Invoice
AFTER INSERT AS
BEGIN

CREATE TABLE #TEMPTABLE
(
    
    BatchID int,
    InvoiceID int,
	BatchSeqNum int
)

INSERT INTO #TEMPTABLE
SELECT batchID, InvoiceID, ROW_NUMBER() Over(partition by batchID order by invoiceID ) as BatchSeqNum
FROM tbl_Invoice

SELECT *
FROM #TEMPTABLE 

UPDATE
    tbl_Invoice
SET
    BatchSeqNum = #TEMPTABLE.BatchSeqNum
FROM
    tbl_Invoice
INNER JOIN
    #TEMPTABLE
ON 
    tbl_Invoice.InvoiceID = #TEMPTABLE.InvoiceID;


DROP TABLE #TEMPTABLE
END
GO